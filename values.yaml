# Default values for kurrier.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Global settings
global:
  # -- Docker image registry
  imageRegistry: ""
  # -- Image pull secrets for all deployments
  imagePullSecrets: []
  # -- Storage class for all PVCs
  storageClass: ""

# -- Common configuration
nameOverride: ""
fullnameOverride: ""

# -- Kurrier Web Dashboard configuration
web:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/kurrier-org/kurrier-web
    pullPolicy: IfNotPresent
    tag: ""
  imagePullSecrets: []
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 1000
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
  service:
    type: ClusterIP
    port: 3000
    annotations: {}
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  livenessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
  readinessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
  env: []
  extraVolumeMounts: []
  extraVolumes: []

# -- Nitro Worker (API) configuration
worker:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/kurrier-org/kurrier-worker
    pullPolicy: IfNotPresent
    tag: ""
  imagePullSecrets: []
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 1000
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
  service:
    type: ClusterIP
    port: 3001
    annotations: {}
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 512Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
  env: []

# -- Supabase stack configuration (includes PostgreSQL)
supabase:
  enabled: true

  # -- PostgreSQL database (Supabase image with extensions)
  db:
    enabled: true
    image:
      repository: supabase/postgres
      tag: "15.8.1.085"
      pullPolicy: IfNotPresent
    # -- Database password (use existingSecret in production)
    password: "your-super-secret-and-long-postgres-password"
    database: "postgres"
    existingSecret: ""
    secretKey: "postgres-password"
    persistence:
      enabled: true
      size: 20Gi
      storageClass: ""
      accessModes:
        - ReadWriteOnce
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 512Mi
    podAnnotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

  # -- Kong API Gateway
  kong:
    enabled: true
    replicaCount: 1
    image:
      repository: kong
      tag: "2.8.1"
      pullPolicy: IfNotPresent
    service:
      type: ClusterIP
      httpPort: 8000
      httpsPort: 8443
    # -- Number of nginx worker processes (default auto, set lower to reduce memory)
    workerProcesses: "2"
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 250m
        memory: 512Mi
    podAnnotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

  # -- GoTrue (Auth)
  auth:
    enabled: true
    replicaCount: 1
    image:
      repository: supabase/gotrue
      tag: "v2.183.0"
      pullPolicy: IfNotPresent
    service:
      type: ClusterIP
      port: 9999
    siteUrl: "http://localhost:3000"
    additionalRedirectUrls: ""
    jwtExpiry: 3600
    disableSignup: false
    enableAnonymousUsers: false
    externalUrl: ""
    mailer:
      enabled: true
      host: ""
      port: 587
      user: ""
      password: ""
      fromEmail: "noreply@example.com"
      fromName: "Kurrier"
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi
    podAnnotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

  # -- PostgREST
  rest:
    enabled: true
    replicaCount: 1
    image:
      repository: postgrest/postgrest
      tag: "v14.1"
      pullPolicy: IfNotPresent
    service:
      type: ClusterIP
      port: 3000
    dbSchema: "public,storage,graphql_public"
    dbAnonRole: "anon"
    dbUseLegacyGucs: "false"
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi
    podAnnotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

  # -- Realtime
  realtime:
    enabled: true
    replicaCount: 1
    image:
      repository: supabase/realtime
      tag: "v2.63.0"
      pullPolicy: IfNotPresent
    service:
      type: ClusterIP
      port: 4000
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    podAnnotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

  # -- Storage API
  storage:
    enabled: true
    replicaCount: 1
    image:
      repository: supabase/storage-api
      tag: "v1.33.0"
      pullPolicy: IfNotPresent
    service:
      type: ClusterIP
      port: 5000
    backend: "file"
    storageSize: 10Gi
    s3:
      bucket: ""
      endpoint: ""
      region: ""
      accessKeyId: ""
      secretAccessKey: ""
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi
    podAnnotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

  # -- Postgres Meta
  meta:
    enabled: true
    replicaCount: 1
    image:
      repository: supabase/postgres-meta
      tag: "v0.93.1"
      pullPolicy: IfNotPresent
    service:
      type: ClusterIP
      port: 8080
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi
    podAnnotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

  # -- Studio Dashboard
  studio:
    enabled: true
    replicaCount: 1
    image:
      repository: supabase/studio
      tag: "2025.12.09-sha-434634f"
      pullPolicy: IfNotPresent
    service:
      type: ClusterIP
      port: 3000
    username: "supabase"
    password: "this_password_is_insecure_and_should_be_updated"
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi
    podAnnotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

# -- External PostgreSQL (alternative to supabase.db)
externalPostgresql:
  enabled: false
  host: ""
  port: 5432
  database: "postgres"
  username: "postgres"
  password: ""
  existingSecret: ""
  secretKey: "postgresql-password"

# -- Typesense search engine
typesense:
  enabled: true
  replicaCount: 1
  image:
    repository: typesense/typesense
    tag: "29.0"
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8108
  apiKey: "supersecretkey"
  existingSecret: ""
  secretKey: "api-key"
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""
    accessModes:
      - ReadWriteOnce
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 512Mi
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

# -- DAV services (CardDAV/CalDAV)
dav:
  enabled: true
  radicale:
    enabled: true
    replicaCount: 1
    image:
      repository: tomsquest/docker-radicale
      tag: "3.5.4.0"
      pullPolicy: IfNotPresent
    service:
      type: ClusterIP
      port: 5232
    persistence:
      enabled: true
      size: 5Gi
      storageClass: ""
      accessModes:
        - ReadWriteOnce
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi
    podAnnotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}
  # -- Worker DAV data persistence (sqlite database for DAV sync)
  worker:
    persistence:
      enabled: true
      size: 1Gi
      storageClass: ""
      accessModes:
        - ReadWriteOnce

# -- Valkey (Redis-compatible) cache
valkey:
  enabled: true
  image:
    repository: valkey/valkey
    tag: "8.1.5"
    pullPolicy: IfNotPresent
  # -- Password (use existingSecret in production)
  password: "replace_with_your_valkey_password"
  existingSecret: ""
  secretKey: "valkey-password"
  service:
    type: ClusterIP
    port: 6379
  persistence:
    enabled: true
    size: 8Gi
    storageClass: ""
    accessModes:
      - ReadWriteOnce
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

# -- External Redis/Valkey
externalRedis:
  enabled: false
  host: ""
  port: 6379
  password: ""
  existingSecret: ""
  secretKey: "redis-password"
  tls:
    enabled: false

# -- Kurrier-specific configuration
kurrier:
  # -- Public URL for the Kurrier web dashboard (used by browser)
  webUrl: "http://localhost:3000"
  # -- Internal API URL (backend-to-backend communication)
  apiUrl: "http://localhost:3001"
  # -- Public API URL (used by browser to reach Supabase API via Kong)
  # This must be reachable from the browser - typically the same as webUrl
  # when API paths like /auth/v1, /rest/v1, etc. are on the same host
  apiPublicUrl: "http://localhost:3000"
  localTunnelUrl: ""
  # -- Skip TLS certificate verification for internal API calls
  # Enable this when using a private CA (like step-ca) that Node.js doesn't trust
  # WARNING: Only use in development/internal environments, not production
  skipTlsVerify: false

  jwt:
    secret: "your-super-secret-jwt-token-with-at-least-32-characters-long"
    anonKey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE"
    serviceRoleKey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q"
    existingSecret: ""
    secretKeys:
      jwtSecret: "jwt-secret"
      anonKey: "anon-key"
      serviceRoleKey: "service-role-key"

  vault:
    encryptionKey: "your-encryption-key-32-chars-min"
    # -- Secret key base for realtime service (must be at least 64 bytes)
    secretKeyBase: "your-secret-key-base-64-chars-minimum-for-realtime-service-sessions"
    existingSecret: ""
    secretKey: "vault-encryption-key"
    secretKeyBaseKey: "secret-key-base"

  rls:
    clientPassword: "replace_with_your_rls_client_password"
    existingSecret: ""
    secretKey: "rls-client-password"

# -- Ingress configuration (traditional Kubernetes Ingress)
# Note: Supabase API paths use /v1 suffixes to avoid conflicts with web UI routes
# (e.g., /auth/v1 for API, allowing /auth/login for web UI login page)
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: kurrier.local
      paths:
        # Supabase API endpoints via Kong - versioned paths to avoid web UI conflicts
        - path: /rest/v1
          pathType: Prefix
          service: kong
        - path: /auth/v1
          pathType: Prefix
          service: kong
        - path: /storage/v1
          pathType: Prefix
          service: kong
        - path: /realtime/v1
          pathType: Prefix
          service: kong
        # Kurrier Web - main UI (catch-all, must be last)
        - path: /
          pathType: Prefix
          service: web
  tls: []
  # -- Separate ingress for Supabase Studio (optional, uses different hostname)
  studio:
    enabled: false
    className: ""
    annotations: {}
    host: kurrier-studio.local
    tls: []

# -- Gateway API configuration (HTTPRoute)
gateway:
  enabled: false
  # -- Annotations to add to the HTTPRoute
  annotations: {}
  # -- Parent Gateway references
  parentRefs:
    - name: pomerium
      namespace: pomerium
      sectionName: https
  # -- Hostnames for the HTTPRoute
  hostnames:
    - kurrier.local
  # -- Path prefix for Supabase Studio (set to "" to disable)
  studioPath: "/studio"

# -- Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# -- Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  minAvailable: 1
  maxUnavailable: ""

# -- Network policies
networkPolicy:
  enabled: false
  ingressNsMatchLabels: {}
  ingressPodMatchLabels: {}

# -- Extra manifests
extraManifests: []
